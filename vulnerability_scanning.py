import subprocess


def run_nikto(ip, ports=None):
    command = ["nikto", "-h", ip]

    if ports:
        command.extend(["-p", ports])

    try:
        process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, text=True)
        output = ""

        for line in iter(process.stdout.readline, ''):
            print(line.strip())
            output += line

        process.stdout.close()
        return_code = process.wait()

        if return_code != 0:
            print(f"Error running Nikto on {ip}. Return code: {return_code}")

        return output  # Return the captured output

    except Exception as e:
        print(f"Error running Nikto on {ip}: {e}")
        return ""  # Return an empty string if there is an error

